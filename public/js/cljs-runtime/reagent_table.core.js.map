{"version":3,"sources":["reagent_table/core.cljs"],"mappings":"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","names":["reagent-table.core/drag-move-fn","on-drag","evt","G__28560","G__28561","reagent-table.core/drag-end-fn","drag-move","drag-end","goog.events/unlisten","js/window","goog.events.EventType/MOUSEMOVE","cljs.core/deref","goog.events.EventType/MOUSEUP","reagent-table.core/dragging","drag-end-atom","cljs.core.atom","cljs.core/reset!","goog.events/listen","reagent-table.core/table-scroll","e","scroller","translate","all-th","thead","reagent-table.core/scroll-to","event","direction","page","cur","view-height","cell","scroll-dist","or__4126__auto__","and__4115__auto__","reagent-table.core/wheel-scroll","reagent-table.core/key-scroll","G__28562","reagent-table.core/init-scrolling","container","reagent.core/dom-node","reagent-table.core/recursive-merge","a","b","cljs.core/map?","cljs.core.merge_with","reagent-table.core/column-index-to-model","state-atom","view-col","cljs.core.nth","reagent-table.core/reorder-column-index-to-model!","drag-col","drop-col","lower-bound","x__4217__auto__","y__4218__auto__","upper-bound","x__4214__auto__","y__4215__auto__","moving-model","cljs.core.swap_BANG_","cljs.core/assoc","cljs.core.into","cljs.core.map_indexed","model-col","cljs.core._EQ_","G__28563","G__28564","reagent-table.core/default-config","p1__28565#","p1__28566#","reagent-table.core/resize-widget","cell-container","cell-node","init-x","init-width","x","_","reagent-table.core/update-sort-columns!","append","sorting","cljs.core/not","cljs.core/first","found","result","column","this-col","this-dir","cljs.core/second","cljs.core/rest","cljs.core.conj","reagent-table.core/is-sorting","render-info","p1__28567#","cljs.core.filter","reagent-table.core/header-cell-fn","config","data-atom","map__28570","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply","cljs.core/hash-map","cljs.core.get","state","col-hidden","draggable","sort-fn","column-model","sortable","sort-click-fn","G__28572","G__28573","G__28574","p1__28568#","G__28575","col-hover","col-sorting","cljs.core.merge","cljs.core.get_in","p1__28569#","pred__28576","expr__28577","cljs.core/=","reagent.core/current-component","reagent-table.core/header-row-fn","cljs.core.doall","reagent-table.core/row-fn","row","row-num","row-key-fn","col-key-fn","col-num","col-model","cell-fn","G__28579","G__28580","G__28581","G__28582","reagent-table.core/rows-fn","rows","reagent-table.core/column-selector","selector-config","hidden-cols","reagent.core/cursor","li-config","hidden-a","reagent-table.core/init-column-index","headers","idx","reagent-table.core/the-table","scroll-height","table-container","reagent.core.create_class","this","temp__5735__auto__","caption","reagent-table.core/reagent-table","map__28583","reagent.core.atom","render-cell","js/Error"],"sourcesContent":["(ns reagent-table.core\n    (:require [reagent.core :as r]\n              [goog.events :as events])\n    (:import [goog.events EventType]))\n\n;;; Is the code horrible? Yup! (contributor: not that bad)\n;;; Does it work? Yup! (contributor: by and large)\n;;; Do I have time to clean it up? Not really... (contributor: let's have a go)\n\n(defn- drag-move-fn [on-drag]\n  (fn [evt]\n    (.preventDefault evt) ;; otherwise we select text while resizing\n    (on-drag (.-clientX evt) (.-clientY evt))))\n\n(defn- drag-end-fn [drag-move drag-end]\n  (fn [evt]\n    (events/unlisten js/window EventType.MOUSEMOVE drag-move)\n    (events/unlisten js/window EventType.MOUSEUP @drag-end)))\n\n(defn- dragging [on-drag]\n  (let [drag-move (drag-move-fn on-drag)\n        drag-end-atom (atom nil)\n        drag-end (drag-end-fn drag-move drag-end-atom)]\n    (reset! drag-end-atom drag-end)\n    (events/listen js/window EventType.MOUSEMOVE drag-move)\n    (events/listen js/window EventType.MOUSEUP drag-end)))\n\n; See https://stackoverflow.com/questions/673153/html-table-with-fixed-headers\n(defn- table-scroll\n  \"Handler for scrolling events from the table's containing div.\n  Keep the position of the headers apparently fixed while the div\n  is scrolled. Moves <thead>. May be needs to move all <th> for IE...\"\n  [e]\n  (let [scroller (.-target e)\n        translate (str \"translate(0,\" (dec (.-scrollTop scroller)) \"px)\")\n        all-th (.querySelectorAll scroller \"th\")\n        thead (.querySelector scroller \"thead\")]\n    ;(doseq [th (array-seq all-th)]  ; may be these for IE ?\n     ; (set! (-> th .-style .-transform) translate))\n    (set! (-> thead .-style .-transform) translate)))\n\n(defn- scroll-to [event direction page]\n  (let [scroller    (.-currentTarget event)\n        cur         (.-scrollTop scroller)\n        view-height (.-clientHeight scroller)\n        cell        (.querySelector scroller \"td\")\n        scroll-dist (if page view-height\n                             (or (and cell\n                                      (.-clientHeight cell))\n                                 0))]\n    (.preventDefault event)\n    (set! (.-scrollTop scroller)\n          (+ cur (* scroll-dist direction)))))\n\n(defn- wheel-scroll\n  [e]\n  (scroll-to\n    e\n    (if (pos? (.-deltaY e)) 1 -1)\n    false))\n\n(defn- key-scroll\n  [e]\n  (case (.-key e)\n    \"ArrowUp\"\n    (scroll-to e -1 false)\n    \"ArrowDown\"\n    (scroll-to e 1 false)\n    \"PageDown\"\n    (scroll-to e 1 true)\n    \"PageUp\"\n    (scroll-to e -1 true)\n    \" \"\n    (scroll-to e 1 false)\n    \"default\"))\n\n(defn- init-scrolling\n  [scroller]\n  (let [container (r/dom-node scroller)]\n    ;    (events/listen container EventType.SCROLL table-scroll) ;leave behind in case switch to goog events\n    ;    ;(events/listen container EventType.WHEEL table-scroll)\n    (.addEventListener container \"scroll\" table-scroll false)\n    (.addEventListener container \"wheel\" wheel-scroll false)\n    (.addEventListener container \"keydown\" key-scroll false)))\n\n(defn- recursive-merge\n  \"Recursively merge hash maps.\"\n  [a b]\n  (if (and (map? a) (map? b))\n    (merge-with recursive-merge a b)\n    b))\n\n(defn- column-index-to-model\n  \"Convert the given column in view coordinates to\n  model coordinates.\"\n  [state-atom view-col]\n  (-> @state-atom\n      :col-index-to-model\n      (nth view-col)))\n\n(defn- reorder-column-index-to-model!\n  \"Maintain the column-index-to-model mapping after\n  view reordering. The arguments are the drag and drop\n  columns, in view coordinates.\"\n  [drag-col drop-col state-atom]\n  (let [cur          (:col-index-to-model @state-atom)\n        lower-bound  (min drag-col drop-col)\n        upper-bound  (max drag-col drop-col)\n        direction    (if (< drag-col drop-col) :right :left)\n        moving-model (column-index-to-model state-atom drag-col)]\n    ;(.log js/console (str \"drag-col: \" drag-col))\n    ;(.log js/console (str \"drop-col: \" drop-col))\n    (swap! state-atom\n           assoc :col-index-to-model\n                 (into []\n                       (map-indexed\n                         (fn [view-col model-col]\n                           (cond (= view-col drop-col)\n                                 (cur drag-col)\n\n                                 (or (< view-col lower-bound)\n                                     (> view-col upper-bound))\n                                 (cur view-col)\n\n                                 (and (>= view-col lower-bound)\n                                      (= direction :right))\n                                 (cur (inc view-col))\n\n                                 (and (<= view-col upper-bound)\n                                      (= direction :left))\n                                 (cur (dec view-col))))\n                         cur)))))\n\n(def default-config {:table\n                      {:style {:width nil}}})\n\n(defn- resize-widget [cell-container]\n  [:span {:style {:display \"inline-block\"\n                  :width \"8px\"\n                  :position \"absolute\"\n                  :cursor \"ew-resize\"\n                  :height \"100%\"\n                  :top 0\n                  :right 0\n                  ;:background-color \"black\" ;; for debug\n                  }\n          :on-click #(.stopPropagation %)\n          :on-mouse-down #(let [cell-node (r/dom-node cell-container)\n                                init-x (.-clientX %)\n                                init-width (.-clientWidth cell-node)]\n                            (dragging\n                             (fn [x _]\n                               (aset cell-node \"width\" (- init-width (- init-x x)))))\n                            (.preventDefault %))}])\n\n(defn- update-sort-columns!\n  \"Maintain multiple sort columns each with individual directions. The\n  column numbers are in model coordinates.\n\n  A column is initially set to ascending order and toggled thereafter.\n  If a column is not present in list it is appended or becomes the only\n  element when 'append' is false.\"\n  [model-col state-atom append]\n  (let [sorting (:sorting @state-atom)]\n    (swap! state-atom\n           assoc :sorting\n           (if-not append\n             [[model-col (if (= (first sorting) [model-col :asc]) :desc :asc)]]\n             (loop [sorting sorting\n                    found false\n                    result []]\n               (let [column (first sorting)\n                     this-col (first column)\n                     this-dir (second column)]\n                 (if column\n                   (if (= model-col this-col)\n                     (recur (rest sorting)\n                            true\n                            (conj result [model-col (if (= this-dir :asc) :desc :asc)]))\n                     (recur (rest sorting)\n                            found\n                            (conj result column)))\n                   (if found\n                     result\n                     (conj result [model-col :asc])))))))))\n\n(defn- is-sorting\n  \"Return the sort direction for the specified column number, nil\n  if the column is not currently sorted, or :none if the column is not\n  sortable at all. Column number must be in model coordinates.\"\n  [sorting render-info model-col]\n  (if (false? (:sortable render-info))\n    :none\n    (-> (filter #(= (first %) model-col)\n                sorting)\n        first\n        second)))\n\n(defn- header-cell-fn [render-info\n                       view-col\n                       model-col\n                       config\n                       state-atom\n                       data-atom]\n  (let [state         @state-atom\n        col-hidden    (:col-hidden state)\n        {:keys [draggable]} state\n        sort-fn       (:sort config)\n        column-model  (:column-model config)\n        sortable      (not (false? (:sortable render-info)))\n        sort-click-fn (fn [append]\n                        (when sort-fn\n                          (reset! data-atom (sort-fn @data-atom\n                                                     column-model\n                                                     (:sorting (update-sort-columns! model-col state-atom append))))))]\n    [:th\n     (recursive-merge\n      (:th config)\n      {:draggable draggable\n       :on-drag-start #(do (doto (.-dataTransfer %)\n                             (.setData \"text/plain\" \"\")) ;; for Firefox\n                           (swap! state-atom assoc :col-reordering true))\n       :on-drag-over #(swap! state-atom assoc :col-hover view-col)\n       :on-drag-end #(let [col-hover (:col-hover @state-atom)\n                           col-sorting (first (get @state-atom :sorting))]\n                       (when-not (= view-col col-hover) ;; if dropped on another column\n                         (reorder-column-index-to-model! view-col col-hover state-atom))\n                       (swap! state-atom assoc\n                              :col-hover nil\n                              :col-reordering nil))\n       :style (merge (get-in config [:th :style])\n                     {:position \"relative\"\n                      :cursor (if draggable \"move\" nil)\n                      :display (when (get col-hidden model-col) \"none\")}\n                     (when (and (:col-reordering state)\n                                (= view-col (:col-hover state)))\n                       {:border-right \"6px solid #3366CC\"}))})\n     [:span {:style {:padding-right 50}} (:header render-info)]\n     (when (and sort-fn sortable)\n       [:span {:style {:position \"absolute\"\n                       :text-align \"center\"\n                       :height \"1.5em\"\n                       :width \"1.5em\"\n                       :right \"15px\"\n                       :cursor \"pointer\"}\n               :on-click #(sort-click-fn (.-ctrlKey %))}\n        (condp = (is-sorting (:sorting state) render-info model-col)\n          :asc \" \u25b2\"\n          :desc \" \u25bc\"\n          :none nil                          ;; not sortable\n          [:span {:style {:opacity \"0.3\"}}   ;; sortable but not participating\n           \" \u25bc\"])])\n     [resize-widget (r/current-component)]]))\n\n\n(defn- header-row-fn [column-model config data-atom state-atom]\n  [:tr\n   (doall (map-indexed (fn [view-col _]\n                         (let [model-col (column-index-to-model state-atom view-col)\n                               render-info (column-model model-col)]\n                           ^{:key (or (:key render-info) model-col)}\n                           [header-cell-fn render-info view-col model-col config state-atom data-atom]))\n                       column-model))])\n\n\n(defn- row-fn [row row-num row-key-fn state-atom config]\n  (let [state @state-atom\n        col-hidden (:col-hidden state)\n        col-key-fn (:col-key       config (fn [row row-num col-num] col-num))\n        col-model  (:column-model  config)\n        cell-fn    (:render-cell   config)]\n    ^{:key (row-key-fn row row-num)}\n    [:tr\n     (doall\n       (map-indexed (fn [view-col _]\n                      (let [model-col (column-index-to-model state-atom view-col)]\n                        ^{:key (col-key-fn row row-num model-col)}\n                        [:td\n                         {:style  {:border-right (when (and (:col-reordering state)\n                                                            (= view-col (:col-hover state)))\n                                                             \"2px solid #3366CC\")\n                                   :display      (when (get col-hidden model-col) \"none\")}}\n                         (cell-fn (col-model model-col) row row-num model-col)]))\n                    (or\n                      col-model\n                      row)))]))\n  \n(defn- rows-fn [rows state-atom config]\n  (let [row-key-fn (:row-key config (fn [row row-num] row-num))]\n  (doall (map-indexed\n           (fn [row-num row]\n             (row-fn row row-num row-key-fn state-atom config))\n           rows))))\n\n(defn- column-selector [state-atom selector-config column-model]\n  (let [hidden-cols (r/cursor state-atom [:col-hidden])\n        li-config (get-in selector-config [:ul :li])]\n    [:ul ;(:ul selector-config)\n     (doall\n       (map-indexed (fn [view-col _]\n                      (let [model-col (column-index-to-model state-atom view-col)\n                            render-info (column-model model-col)\n                            hidden-a (r/cursor hidden-cols [model-col])]\n                        ^{:key (or (:key render-info) model-col)}\n                        [:li (recursive-merge\n                               {:style {:margin 8\n                                        :cursor \"pointer\"}\n                                :on-click #(do (swap! hidden-a not) nil)}\n                               li-config)\n                         (:header render-info) \" \"(if @hidden-a \"\u2610\" \"\u2611\")]))\n                    column-model))]))\n\n(defn- init-column-index\n  \"Set up in the initial column-index-to-model numbers\"\n  [headers]\n  (into [] (map-indexed (fn [idx _] idx) headers)))\n\n(defn- the-table\n  [config column-model data-atom state-atom]\n  (let [scroll-height   (:scroll-height config)\n        table-container (:table-container config)]\n    (r/create-class {:component-did-mount    (fn [this] (init-scrolling this))\n                     :reagent-render         (fn [] [:div.reagent-table-container\n                                                     (if scroll-height (recursive-merge\n                                                                         table-container\n                                                                         {:tab-index 0\n                                                                          :style     {:height   scroll-height\n                                                                                      :overflow \"auto\"}})\n                                                                       table-container)\n                                                     [:table.reagent-table (:table config)\n                                                      (when-let [caption (:caption config)]\n                                                        caption)\n                                                      [:thead (:thead config)\n                                                       (header-row-fn column-model\n                                                                      config\n                                                                      data-atom\n                                                                      state-atom)]\n                                                      [:tbody (:tbody config)\n                                                       (rows-fn @data-atom state-atom config)]]])})))\n\n(defn reagent-table\n  \"Create a table, rendering the vector held in data-atom and\n  configured using the map config. The minimum requirements of\n  config are :render-cell and :column-model.\n\n  There is a distinction between view and model coordinates for\n  column numbers. A column's view position may change if it is\n  reordered, whereas its model position will be that of its index\n  into :column-model\n\n  :column-model is a vector of so-called render-info maps containing\n   - :header A string for the header cell text\n   - :key The reagent key for the column position in any rows. If\n     absent defaults to the model index\n   - :sortable false When :sort is present (see below) by default all\n     columns are sortable. Otherwise any column can be excluded and no\n     glyph will appear in its header.\n  Other entries are as required by the client. The map is passed to\n  the :render-cell function when cells are rendered.\n\n  :render-cell a function that returns the hiccup for a table cell\n    (fn [render-info row row-num col-num] (...))\n  where render-info is the column entry, row is the vector child from\n  data-atom, row-num is the row number and col-num is the column number\n  in model coordiates.\n\n  :table-state an atom used to hold table internal state. If supplied by\n  the client then a way to see table state at the repl, and to allow the\n  client to modify column order and sorting state.\n\n  :row-key a function that returns a value to be used as the regaent key\n  for rows\n    (fn [row row-num] (...))\n  where row is the vector child from data-atom, row-num is the row number.\n\n  :sort a function to sort data-atom when a header cell sort arrow is clicked.\n  Returns the newly sorted vector. If absent, the table is not sortable and no\n  glyphs appear in the header.\n    (fn [rows column-model sorting] (...))\n  where rows is the vector to sort, column-model is the :column-model and sorting\n  is a vector of vectors of the form [column-model-index :asc|:desc]. If the\n  column-model entry includes :sortable false the individual column is excluded\n  from sorting. Select multiple columns for sorting by using ctrl-click. Repeat\n  to toggle the sort direction.\n\n  :table the attributes applied to the [:table ... ] element. Defaults\n  to {:style {:width nil}}}\n\n  :thead the attributes applied to [:thead ...]\n\n  :tbody the attributes applied to [:tbody ...]\n\n  :caption an optional hiccup form for a caption\n\n  :column-selection optional attributes to display visibly column toggles\n  for example {:ul {:li {:class \\\"btn\\\"}}}\n  \"\n  [data-atom config]\n  (let [config (recursive-merge default-config config)\n        state-atom (or (:table-state config) (r/atom {})) ;; a place for the table local state\n        {:keys [render-cell column-model]} config]\n    (assert (and render-cell column-model)\n            \"Must provide :column-model and :render-cell in table config\")\n    (swap! state-atom assoc :col-index-to-model (init-column-index column-model))\n    (fn []\n        [:div\n         [:style (str \".reagent-table * table {table-layout:fixed;}\"\n                      \".reagent-table * td { max-width: 3px;\"\n                      \"overflow: hidden;text-overflow: ellipsis;white-space: nowrap;}\")]\n         (when-let [selector-config (:column-selection config)]\n           [column-selector state-atom selector-config column-model])\n         [the-table config column-model data-atom state-atom]])))\n\n"]}